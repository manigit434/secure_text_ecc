{% extends "base.html" %}

{% block title %}My Submissions | SecureText ECC{% endblock %}

{% block content %}

<!-- =========================
     HEADER
========================= -->
<div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">

  <div>
    <h2 class="dashboard-title mb-1">
      <i class="bi bi-lock-fill"></i>
      Encrypted Dashboard
    </h2>
    <p class="text-muted-readable mb-0">
      All submissions are stored as <strong>ciphertext only</strong>.
      Plaintext is never persisted.
    </p>
  </div>

  <a href="{% url 'core:submit' %}" class="btn btn-outline-primary btn-lg">
    <i class="bi bi-plus-circle"></i>
    New Secure Submission
  </a>

</div>

<!-- =========================
     SUBMISSIONS GRID
========================= -->
<div class="row g-4">

{% if subs %}
  {% for sub in subs %}
    <div class="col-md-6 col-lg-4">
      <div class="glass p-4 h-100 d-flex flex-column">

        <!-- HEADER -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6 class="fw-semibold mb-0 text-readable">
            Submission #{{ sub.id }}
          </h6>

          <span class="badge bg-secondary">
            <i class="bi bi-shield-lock"></i> Encrypted
          </span>
        </div>

        <!-- META -->
        <div class="text-muted-readable small mb-4">
          <i class="bi bi-clock"></i>
          {{ sub.created_at|date:"M d, Y Â· H:i" }}
        </div>

        <!-- ACTION -->
        <div class="mt-auto">

          {% if request.user.is_staff %}
            <a
              href="{% url 'core:admin_decrypt' sub.id %}"
              class="btn btn-outline-warning w-100"
            >
              <i class="bi bi-unlock"></i>
              Admin Decrypt
            </a>
          {% else %}
            <div class="text-center p-3 rounded bg-dark bg-opacity-25">
              <i class="bi bi-shield-lock fs-2 text-muted-readable"></i>
              <div class="small text-muted-readable mt-2">
                Admin privileges required to decrypt
              </div>
            </div>
          {% endif %}

        </div>

      </div>
    </div>
  {% endfor %}

{% else %}
  <!-- =========================
       EMPTY STATE
  ========================== -->
  <div class="col-12">
    <div class="empty-state py-5">

      <i class="bi bi-inbox fs-1 mb-3"></i>

      <h4 class="text-readable">
        No encrypted submissions found
      </h4>

      <p class="text-muted-readable mb-4">
        You have not submitted any secure messages yet.
      </p>

      <a href="{% url 'core:submit' %}" class="btn btn-outline-primary btn-lg">
        <i class="bi bi-plus-circle"></i>
        Create First Secure Submission
      </a>

    </div>
  </div>
{% endif %}

</div>

<!-- =========================
     SECURITY NOTICE
========================= -->
<div class="alert alert-security mt-5">
  <i class="bi bi-shield-check"></i>
  <strong>Security Notice:</strong>
  This dashboard displays metadata only. Message content remains encrypted at rest.
  Decryption is restricted to authorized admin users and occurs temporarily in memory.
</div>

{% endblock %}
